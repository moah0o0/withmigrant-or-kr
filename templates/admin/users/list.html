{% extends 'admin/base.html' %}

{% block title %}ê´€ë¦¬ì ê³„ì •{% endblock %}

{% block breadcrumb %}
<span class="text-notion-text-secondary">ì‹œìŠ¤í…œ</span>
<span class="mx-2 text-notion-text-muted">/</span>
<span class="text-notion-text font-medium">ê´€ë¦¬ì ê³„ì •</span>
{% endblock %}

{% block content %}
<!-- í—¤ë” -->
<div class="flex items-center justify-between mb-6">
    <h1 class="text-xl font-semibold text-notion-text">ê´€ë¦¬ì ê³„ì •</h1>
    <a href="{{ url_for('admin.users_new') }}" class="btn-notion btn-primary">
        + ìƒˆ ê´€ë¦¬ì
    </a>
</div>

<!-- ëª©ë¡ -->
<div class="card-notion">
    <table class="table-notion">
        <thead>
            <tr>
                <th class="w-28">ì•„ì´ë””</th>
                <th>ì´ë¦„</th>
                <th class="w-32">ê¶Œí•œ</th>
                <th class="w-24 text-center">ìƒíƒœ</th>
                <th class="w-40 text-center">ë§ˆì§€ë§‰ ë¡œê·¸ì¸</th>
                <th class="w-28 text-center">ê°€ì…ì¼</th>
                <th class="w-32 text-center">ê´€ë¦¬</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr class="{{ 'opacity-50' if not user.is_active else '' }}">
                <td class="font-mono text-sm">{{ user.username }}</td>
                <td class="font-medium text-notion-text">
                    {{ user.name or '-' }}
                    {% if user.id == session.get('admin_id') %}
                    <span class="text-xs text-notion-accent ml-1">(ë‚˜)</span>
                    {% endif %}
                </td>
                <td>
                    {% if user.role == 'super_admin' %}
                    <span class="inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-purple-700 bg-purple-100 rounded">
                        ğŸ‘‘ ìµœê³ ê´€ë¦¬ì
                    </span>
                    {% else %}
                    <span class="inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-blue-700 bg-blue-100 rounded">
                        ğŸ‘¤ ê´€ë¦¬ì
                    </span>
                    {% endif %}
                </td>
                <td class="text-center">
                    {% if user.is_active %}
                    <span class="inline-block w-2 h-2 rounded-full bg-green-500"></span>
                    <span class="text-xs text-green-600 ml-1">í™œì„±</span>
                    {% else %}
                    <span class="inline-block w-2 h-2 rounded-full bg-gray-300"></span>
                    <span class="text-xs text-gray-500 ml-1">ë¹„í™œì„±</span>
                    {% endif %}
                </td>
                <td class="text-center text-sm text-notion-text-secondary">
                    {{ user.last_login.strftime('%Y.%m.%d %H:%M') if user.last_login else 'ì—†ìŒ' }}
                </td>
                <td class="text-center text-sm text-notion-text-secondary">
                    {{ user.created_at.strftime('%Y.%m.%d') if user.created_at else '-' }}
                </td>
                <td class="text-center">
                    <div class="flex items-center justify-center gap-2">
                        <a href="{{ url_for('admin.users_edit', id=user.id) }}"
                           class="text-xs text-notion-accent hover:underline">ìˆ˜ì •</a>
                        {% if user.id != session.get('admin_id') %}
                        <button onclick="deleteUser({{ user.id }}, '{{ user.username }}')"
                                class="text-xs text-red-500 hover:underline">ì‚­ì œ</button>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="text-center py-12 text-notion-text-muted">
                    ë“±ë¡ëœ ê´€ë¦¬ìê°€ ì—†ìŠµë‹ˆë‹¤.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- ì•ˆë‚´ -->
<div class="mt-6 p-4 bg-notion-sidebar rounded-lg text-sm text-notion-text-secondary">
    <strong>ê¶Œí•œ ì•ˆë‚´</strong>
    <ul class="mt-2 space-y-1 list-disc list-inside">
        <li><strong>ìµœê³ ê´€ë¦¬ì</strong>: ëª¨ë“  ê¸°ëŠ¥ + ê´€ë¦¬ì ê³„ì • ê´€ë¦¬</li>
        <li><strong>ê´€ë¦¬ì</strong>: ì½˜í…ì¸  ê´€ë¦¬, ì‚¬ì´íŠ¸ ì„¤ì •, í›„ì›ì‹ ì²­ í™•ì¸</li>
    </ul>
</div>
{% endblock %}

{% block scripts %}
<script>
function deleteUser(id, username) {
    if (!confirm(`'${username}' ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œëœ ê³„ì •ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) return;

    fetch(`/users/${id}/delete`, {
        method: 'POST'
    })
    .then(() => {
        location.reload();
    });
}
</script>
{% endblock %}
