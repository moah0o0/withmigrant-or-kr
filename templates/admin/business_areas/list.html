{% extends 'admin/base.html' %}

{% block title %}ì‚¬ì—…ë¶„ì•¼ ê´€ë¦¬{% endblock %}

{% block breadcrumb %}
<span class="text-notion-text-secondary">ì‚¬ì´íŠ¸ ì„¤ì •</span>
<span class="mx-2 text-notion-text-muted">/</span>
<span class="text-notion-text font-medium">ì‚¬ì—…ë¶„ì•¼</span>
{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6">
    <div>
        <h1 class="text-xl font-semibold text-notion-text">ì‚¬ì—…ë¶„ì•¼ ê´€ë¦¬</h1>
        <p class="text-sm text-notion-text-muted mt-1">ì†Œê°œ í˜ì´ì§€ì— í‘œì‹œë˜ëŠ” ì£¼ìš” ì‚¬ì—…ë¶„ì•¼ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
    </div>
    <a href="{{ url_for('admin.business_areas_new') }}" class="btn-notion btn-primary">+ ì‚¬ì—…ë¶„ì•¼ ì¶”ê°€</a>
</div>

<div class="card-notion overflow-hidden">
    <table class="table-notion">
        <thead>
            <tr>
                <th class="w-12"></th>
                <th>ì´ë¦„</th>
                <th>ì„¤ëª…</th>
                <th class="w-20 text-center">ìƒíƒœ</th>
                <th class="w-32 text-center">ê´€ë¦¬</th>
            </tr>
        </thead>
        <tbody id="sortable-list">
            {% for area in areas %}
            <tr data-id="{{ area.id }}">
                <td class="cursor-move text-notion-text-muted">â‹®â‹®</td>
                <td>
                    <div class="flex items-center gap-3">
                        {% if area.image_url %}
                        <img src="{{ area.image_url }}" alt="" class="w-10 h-10 rounded object-cover">
                        {% else %}
                        <div class="w-10 h-10 rounded bg-notion-sidebar flex items-center justify-center text-notion-text-muted">ğŸ“‚</div>
                        {% endif %}
                        <span class="font-medium text-notion-text">{{ area.name }}</span>
                    </div>
                </td>
                <td class="text-sm text-notion-text-secondary">{{ area.description or '-' }}</td>
                <td class="text-center">
                    {% if area.is_active %}
                    <span class="inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded">í™œì„±</span>
                    {% else %}
                    <span class="inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-gray-500 bg-gray-100 rounded">ë¹„í™œì„±</span>
                    {% endif %}
                </td>
                <td class="text-center">
                    <div class="flex items-center justify-center gap-2">
                        <a href="{{ url_for('admin.business_areas_edit', id=area.id) }}" class="text-xs text-blue-600 hover:underline">ìˆ˜ì •</a>
                        <span class="text-notion-text-muted">|</span>
                        <button onclick="deleteItem({{ area.id }})" class="text-xs text-red-600 hover:underline">ì‚­ì œ</button>
                    </div>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="text-center py-12 text-notion-text-muted">
                    ë“±ë¡ëœ ì‚¬ì—…ë¶„ì•¼ê°€ ì—†ìŠµë‹ˆë‹¤.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<p class="text-xs text-notion-text-muted mt-4">ğŸ’¡ í–‰ì„ ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
new Sortable(document.getElementById('sortable-list'), {
    animation: 150,
    handle: 'td:first-child',
    onEnd: function() {
        const order = [...document.querySelectorAll('#sortable-list tr[data-id]')].map(row => row.dataset.id);
        fetch('{{ url_for("admin.business_areas_reorder") }}', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ order })
        });
    }
});

function deleteItem(id) {
    if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        fetch(`/business-areas/${id}/delete`, { method: 'POST' })
            .then(res => {
                if (!res.ok) throw new Error('ì‚­ì œ ì‹¤íŒ¨');
                location.reload();
            })
            .catch(err => {
                console.error('ì‚­ì œ ì˜¤ë¥˜:', err);
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
    }
}
</script>
{% endblock %}
