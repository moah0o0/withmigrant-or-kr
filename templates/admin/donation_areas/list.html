{% extends 'admin/base.html' %}

{% block title %}ν›„μ› κ΄€λ¦¬{% endblock %}

{% block breadcrumb %}
<span class="text-notion-text-secondary">ν•¨κ»ν•λ” λ²•</span>
<span class="mx-2 text-notion-text-muted">/</span>
<span class="text-notion-text font-medium">ν›„μ›</span>
{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6">
    <div>
        <h1 class="text-xl font-semibold text-notion-text">ν›„μ› κ΄€λ¦¬</h1>
        <p class="text-sm text-notion-text-muted mt-1">ν›„μ›μ•λ‚΄ νμ΄μ§€μ— ν‘μ‹λλ” ν›„μ›μ„ κ΄€λ¦¬ν•©λ‹λ‹¤.</p>
    </div>
    <a href="{{ url_for('admin.donation_areas_new') }}" class="btn-notion btn-primary">+ λ¶„μ•Ό μ¶”κ°€</a>
</div>

<div class="card-notion overflow-hidden">
    <table class="table-notion">
        <thead>
            <tr>
                <th class="w-12"></th>
                <th>μ΄λ¦„</th>
                <th>μ„¤λ…</th>
                <th class="w-20 text-center">μƒνƒ</th>
                <th class="w-32 text-center">κ΄€λ¦¬</th>
            </tr>
        </thead>
        <tbody id="sortable-list">
            {% for area in areas %}
            <tr data-id="{{ area.id }}">
                <td class="cursor-move text-notion-text-muted">β‹®β‹®</td>
                <td>
                    <span class="font-medium text-notion-text">{{ area.name }}</span>
                </td>
                <td class="text-sm text-notion-text-secondary">{{ area.description[:50] + '...' if area.description and area.description|length > 50 else area.description or '-' }}</td>
                <td class="text-center">
                    {% if area.is_active %}
                    <span class="inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded">ν™μ„±</span>
                    {% else %}
                    <span class="inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-gray-500 bg-gray-100 rounded">λΉ„ν™μ„±</span>
                    {% endif %}
                </td>
                <td class="text-center">
                    <div class="flex items-center justify-center gap-2">
                        <a href="{{ url_for('admin.donation_areas_edit', id=area.id) }}" class="text-xs text-blue-600 hover:underline">μμ •</a>
                        <span class="text-notion-text-muted">|</span>
                        <button onclick="deleteArea({{ area.id }})" class="text-xs text-red-600 hover:underline">μ‚­μ </button>
                    </div>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="text-center py-12 text-notion-text-muted">
                    λ“±λ΅λ ν›„μ›μ΄ μ—†μµλ‹λ‹¤.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<p class="text-xs text-notion-text-muted mt-4">π’΅ ν–‰μ„ λ“λκ·Έν•μ—¬ μμ„λ¥Ό λ³€κ²½ν•  μ μμµλ‹λ‹¤.</p>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
new Sortable(document.getElementById('sortable-list'), {
    animation: 150,
    handle: 'td:first-child',
    onEnd: function() {
        const order = [...document.querySelectorAll('#sortable-list tr[data-id]')].map(row => row.dataset.id);
        fetch('{{ url_for("admin.donation_areas_reorder") }}', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ order })
        });
    }
});

function deleteArea(id) {
    if (confirm('μ •λ§ μ‚­μ ν•μ‹κ² μµλ‹κΉ?')) {
        fetch(`/donation-areas/${id}/delete`, { method: 'POST' })
            .then(res => {
                if (!res.ok) throw new Error('μ‚­μ  μ‹¤ν¨');
                location.reload();
            })
            .catch(err => {
                console.error('μ‚­μ  μ¤λ¥:', err);
                alert('μ‚­μ  μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤.');
            });
    }
}
</script>
{% endblock %}
